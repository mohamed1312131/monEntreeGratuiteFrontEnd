<div class="foires-container">
  <!-- Modern Header Bar -->
  <div class="header-bar">
    <div class="header-left">
      <div class="title-section">
        <div class="icon-wrapper">
          <mat-icon class="header-icon">event_available</mat-icon>
        </div>
        <div class="title-content">
          <h1 class="header-title">Gestion des Foires & Salons</h1>
          <p class="header-subtitle">Gérez vos événements et réservations</p>
        </div>
      </div>
    </div>
    <div class="header-right">
      <div class="stats-summary">
        <div class="stat-item">
          <mat-icon>event</mat-icon>
          <span class="stat-value">{{ getTotalFoires() }}</span>
          <span class="stat-label">Foires</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Area -->
  <div class="content-wrapper">
    <mat-accordion multi class="compact-accordion">
      <mat-expansion-panel *ngFor="let country of countries" class="country-panel">
        <mat-expansion-panel-header class="compact-panel-header">
          <mat-panel-title>
            <div class="country-title">
              <img [src]="country.image" [alt]="country.name" class="country-flag" />
              <span class="country-name">{{ country.name }}</span>
              <span class="count-badge">{{ country.foires.length }}</span>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="panel-content">
          <!-- Action Bar -->
          <div class="action-bar-inline">
            <button mat-stroked-button class="compact-btn add-btn" (click)="addFoire(country)">
              <mat-icon>add</mat-icon>
              <span>Ajouter</span>
            </button>
          </div>

          <!-- High-Density Table -->
          <div class="table-wrapper">
            <table mat-table [dataSource]="getPaginatedFoires(country)" class="compact-table">
                
              <!-- Image Column -->
              <ng-container matColumnDef="image">
                <th mat-header-cell *matHeaderCellDef class="col-image">IMG</th>
                <td mat-cell *matCellDef="let foire" class="col-image">
                  <div class="image-wrapper">
                    <img [src]="foire.image" [alt]="foire.name" class="foire-thumb" />
                    <div class="image-overlay" *ngIf="foire.isActive">
                      
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Reference Column -->
              <ng-container matColumnDef="url">
                <th mat-header-cell *matHeaderCellDef class="col-ref">Référence</th>
                <td mat-cell *matCellDef="let foire" class="col-ref">
                  <div class="ref-container">
                    
                    <span class="ref-text">{{ foire.url }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Name Column -->
              <ng-container matColumnDef="nomfoire">
                <th mat-header-cell *matHeaderCellDef class="col-name">Nom de la Foire</th>
                <td mat-cell *matCellDef="let foire" class="col-name">
                  <div class="name-container">
                    <span class="name-text" [title]="foire.name">{{ foire.name }}</span>
                    <span class="location-text" *ngIf="foire.location">
                     
                      {{ foire.location }}
                    </span>
                  </div>
                </td>
              </ng-container>

              <!-- Created At Column -->
              <ng-container matColumnDef="createdAt">
                <th mat-header-cell *matHeaderCellDef class="col-created">Créée le</th>
                <td mat-cell *matCellDef="let foire" class="col-created">
                  <span class="date-badge">{{ foire.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                </td>
              </ng-container>

              <!-- Date Ranges Column -->
              <ng-container matColumnDef="datefoire">
                <th mat-header-cell *matHeaderCellDef class="col-date">Périodes</th>
                <td mat-cell *matCellDef="let foire" class="col-date">
                  <div class="date-ranges-cell">
                    <div *ngIf="foire.dateRanges && foire.dateRanges.length > 0" class="ranges-container">
                      <span *ngFor="let range of foire.dateRanges; let i = index" class="date-range-chip">
                        {{ range.startDate | date:'dd/MM' }} - {{ range.endDate | date:'dd/MM/yy' }}
                      </span>
                    </div>
                    <span *ngIf="!foire.dateRanges || foire.dateRanges.length === 0" class="no-dates">Aucune date</span>
                  </div>
                </td>
              </ng-container>

              <!-- Reservations Column -->
              <ng-container matColumnDef="reservations">
                <th mat-header-cell *matHeaderCellDef class="col-res">Réservations</th>
                <td mat-cell *matCellDef="let foire" class="col-res">
                  <span class="res-badge">{{ foire.reservationCount || 0 }}</span>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef class="col-actions">Actions</th>
                <td mat-cell *matCellDef="let foire" class="col-actions">
                  <div class="action-btns">
                    <button mat-icon-button class="action-icon" [class.disponible-icon]="foire.disponible" (click)="toggleDisponible(country.apiKey, foire)" [matTooltip]="foire.disponible ? 'Disponible' : 'Non disponible'">
                      <mat-icon>{{ foire.disponible ? 'check_circle' : 'cancel' }}</mat-icon>
                    </button>
                    <button mat-icon-button class="action-icon" [class.active-icon]="foire.isActive" (click)="activateFoire(country.apiKey, foire)" [matTooltip]="foire.isActive ? 'Désactiver' : 'Activer'">
                      <mat-icon>{{ foire.isActive ? 'toggle_on' : 'toggle_off' }}</mat-icon>
                    </button>
                    <button mat-icon-button class="action-icon email-icon" (click)="sendEmailReminders(foire)" matTooltip="Email">
                      <mat-icon>email</mat-icon>
                    </button>
                    <button mat-icon-button class="action-icon view-icon" (click)="viewDetails(foire)" matTooltip="Détails">
                      <mat-icon>visibility</mat-icon>
                    </button>
                    <button mat-icon-button class="action-icon delete-icon" (click)="deleteFoire(country.apiKey, foire)" matTooltip="Supprimer">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns" class="compact-header"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns" class="compact-row"></tr>
            </table>
          </div>

          <!-- Compact Pagination -->
          <div class="pagination-wrapper" *ngIf="country.foires.length > country.pageSize">
            <button *ngFor="let page of getPages(country)" mat-icon-button [class.active-page]="country.pageIndex === page" (click)="changePage(country, page)" class="page-btn">
              {{ page + 1 }}
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>
