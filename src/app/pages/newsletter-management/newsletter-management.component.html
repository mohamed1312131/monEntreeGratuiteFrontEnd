<div class="newsletter-container">
  <!-- Header -->
  <mat-card class="header-card">
    <mat-card-content>
      <div class="header-content">
        <div class="header-title">
          <mat-icon>mail_outline</mat-icon>
          <h1>Newsletter Subscribers</h1>
        </div>
        <button mat-raised-button color="primary" (click)="toggleAddForm()">
          <mat-icon>{{ showAddForm ? 'close' : 'person_add' }}</mat-icon>
          {{ showAddForm ? 'Cancel' : 'Add Subscriber' }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Statistics Cards -->
  <div class="statistics-grid">
    <mat-card class="stat-card active">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon>check_circle</mat-icon>
          <div class="stat-details">
            <span class="stat-value">{{ statistics.active }}</span>
            <span class="stat-label">Active</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card unsubscribed">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon>unsubscribe</mat-icon>
          <div class="stat-details">
            <span class="stat-value">{{ statistics.unsubscribed }}</span>
            <span class="stat-label">Unsubscribed</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card bounced">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon>error_outline</mat-icon>
          <div class="stat-details">
            <span class="stat-value">{{ statistics.bounced }}</span>
            <span class="stat-label">Bounced</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card complained">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon>report</mat-icon>
          <div class="stat-details">
            <span class="stat-value">{{ statistics.complained }}</span>
            <span class="stat-label">Complained</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Add Subscriber Form -->
  <mat-card *ngIf="showAddForm" class="add-form-card">
    <mat-card-content>
      <h3>Add New Subscriber</h3>
      <form [formGroup]="addSubscriberForm" (ngSubmit)="addSubscriber()">
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" type="email" placeholder="subscriber@example.com">
            <mat-icon matPrefix>email</mat-icon>
            <mat-error *ngIf="addSubscriberForm.get('email')?.hasError('required')">Email is required</mat-error>
            <mat-error *ngIf="addSubscriberForm.get('email')?.hasError('email')">Invalid email format</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Name</mat-label>
            <input matInput formControlName="name" placeholder="Full name">
            <mat-icon matPrefix>person</mat-icon>
            <mat-error>Name is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Phone (Optional)</mat-label>
            <input matInput formControlName="phone" placeholder="+1234567890">
            <mat-icon matPrefix>phone</mat-icon>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button mat-raised-button type="button" (click)="toggleAddForm()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="addSubscriberForm.invalid">
            <mat-icon>add</mat-icon>
            Add Subscriber
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-header">
        <h3>
          <mat-icon>filter_list</mat-icon>
          Filters
        </h3>
        <button mat-button color="warn" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear All
        </button>
      </div>

      <form [formGroup]="filtersForm">
        <div class="filters-grid">
          <mat-form-field appearance="outline">
            <mat-label>Search</mat-label>
            <input matInput formControlName="search" placeholder="Email or name...">
            <mat-icon matPrefix>search</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let option of statusOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>label</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Date From</mat-label>
            <input matInput [matDatepicker]="pickerFrom" formControlName="dateFrom">
            <mat-datepicker-toggle matSuffix [for]="pickerFrom"></mat-datepicker-toggle>
            <mat-datepicker #pickerFrom></mat-datepicker>
            <mat-icon matPrefix>date_range</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Date To</mat-label>
            <input matInput [matDatepicker]="pickerTo" formControlName="dateTo">
            <mat-datepicker-toggle matSuffix [for]="pickerTo"></mat-datepicker-toggle>
            <mat-datepicker #pickerTo></mat-datepicker>
            <mat-icon matPrefix>date_range</mat-icon>
          </mat-form-field>
        </div>
      </form>

      <div class="filter-summary">
        <mat-chip-set>
          <mat-chip class="info-chip">
            <mat-icon>people</mat-icon>
            {{ totalSubscribers }} Subscribers
          </mat-chip>
        </mat-chip-set>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Subscribers Table -->
  <mat-card class="table-card">
    <mat-card-content>
      <div *ngIf="loading" class="loading-state">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading subscribers...</p>
      </div>

      <div *ngIf="!loading && subscribers.length === 0" class="empty-state">
        <mat-icon>inbox</mat-icon>
        <p>No subscribers found. Add your first subscriber to get started!</p>
      </div>

      <div *ngIf="!loading && subscribers.length > 0" class="table-container">
        <table mat-table [dataSource]="subscribers" class="subscribers-table">
          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let subscriber">
              <div class="email-cell">
                <mat-icon>email</mat-icon>
                <span>{{ subscriber.email }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let subscriber">
              <div class="name-cell">
                <mat-icon>person</mat-icon>
                <span>{{ subscriber.name }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let subscriber">
              <mat-chip [class]="'status-chip ' + subscriber.status.toLowerCase()">
                {{ subscriber.status }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Subscribed At Column -->
          <ng-container matColumnDef="subscribedAt">
            <th mat-header-cell *matHeaderCellDef>Subscribed</th>
            <td mat-cell *matCellDef="let subscriber">
              {{ formatDate(subscriber.subscribedAt) }}
            </td>
          </ng-container>

          <!-- Total Emails Sent Column -->
          <ng-container matColumnDef="totalEmailsSent">
            <th mat-header-cell *matHeaderCellDef>Emails Sent</th>
            <td mat-cell *matCellDef="let subscriber">
              <mat-chip class="count-chip">
                <mat-icon>send</mat-icon>
                {{ subscriber.totalEmailsSent }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let subscriber">
              <div class="actions-cell">
                <button mat-icon-button 
                        *ngIf="subscriber.status === 'ACTIVE'"
                        (click)="unsubscribeSubscriber(subscriber)"
                        matTooltip="Unsubscribe"
                        color="warn">
                  <mat-icon>unsubscribe</mat-icon>
                </button>
                <button mat-icon-button 
                        (click)="deleteSubscriber(subscriber)"
                        matTooltip="Delete"
                        color="warn">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <mat-paginator
          [length]="totalSubscribers"
          [pageSize]="pageSize"
          [pageIndex]="pageIndex"
          [pageSizeOptions]="pageSizeOptions"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>
